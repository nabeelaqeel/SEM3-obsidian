
# Advanced Structured Query Language

### SQL Join Operators
- Relational join operation merges rows from two tables and returns rows with one of the following
	- Natural join - Have common values in common columns
	- Equality or inequality - Meet a given join condition 
	- Outer join: Have common values in common columns or have no matching values
- Inner join: Only rows that meet a given criterion are selected

### SQL Join Expression Styles
![](../images/Pasted%20image%2020250206224448.png)
![](../images/Pasted%20image%2020250206224504.png)

### Subqueries and Correlated Queries
- Subquery is a query inside another query
- Subquery can return:
- One single value - One column and one row
- A list of values - One column and multiple rows
- A virtual table - Multicolumn, multirow set of values
- No value - Output of the outer query might result in an error or a null empty set

### WHERE Subqueries
- Uses inner SELECT subquery on the right side of a WHERE comparison expression
- Value generated by the subquery must be of a comparable data type
- If the query returns more than a single value, the DBMS will generate an error
- Can be used in combination with joins

### IN and HAVING Subqueries
- IN subqueries
	- Used to compare a single attribute to a list of values
- HAVING subqueries
	- HAVING clause restricts the output of a GROUP BY query by applying conditional criteria to the grouped rows

### Multirow Subquery Operators: ANY and ALL
- ALL operator
	- Allows comparison of a single value with a list of values returned by the first subquery 
		- Uses a comparison operator other than equals
- ANY operator
	- Allows comparison of a single value to a list of values and selects only the rows for which the value is greater than or less than any value in the list

### FROM Subqueries
- FROM clause:
- Specifies the tables from which the data will be drawn
- Can use SELECT subquery

### Attribute List Subqueries
- SELECT statement uses attribute list to indicate what columns to project in the resulting set
- Inline subquery
	- Subquery expression included in the attribute list that must return one value
- Column alias cannot be used in attribute list computation if alias is defined in the same attribute list

### Correlated Subquery
- Executes once for each row in the outer query
- Inner query references a column of the outer subquery
- Can be used with the EXISTS special operator

### SQL Functions
- Functions always use a numerical, date, or string value
- Value may be part of a command or may be an attribute located in a table
- Function may appear anywhere in an SQL statement where a value or an attribute can be used

### SQL Functions
![](../images/Pasted%20image%2020250206225209.png)

### Relational Set Operators
- SQL data manipulation commands are set-oriented
	- Set-oriented: Operate over entire sets of rows and columns at once
- UNION, INTERSECT, and Except (MINUS) work properly when relations are union-compatible
	- Union-compatible: Number of attributes are the same and their corresponding data types are alike 
- UNION
	- Combines rows from two or more queries without including duplicate rows
	- Syntax - query UNION query 
- UNION ALL
	- Produces a relation that retains duplicate rows
	- Can be used to unite more than two queries
- INTERSECT
	- Combines rows from two queries, returning only the rows that appear in both sets
	- Syntax - query INTERSECT query
- EXCEPT (MINUS)
	- Combines rows from two queries and returns only the rows that appear in the first set 
	- Syntax
		- query EXCEPT query 
		- query MINUS query
	- Syntax alternatives
		- IN and NOT IN subqueries can be used in place of INTERSECT

### Virtual Tables: Creating a View
- View: Virtual table based on a SELECT query
- Base tables: Tables on which the view is based
- CREATE VIEW statement: Data definition command that stores the subquery specification in the data dictionary
	- CREATE VIEW command
		- CREATE VIEW viewname AS SELECT query

### Updatable Views
- Used to update attributes in any base tables used in the view
- `Batch update routine`: Pools multiple transactions into a single batch to update a master table field in a single operation
- Updatable view restrictions
	- GROUP BY expressions or aggregate functions cannot be used
	- Set operators cannot be used
	- JOINs or group operators cannot be used

### Oracle Sequences
- Independent object in the database
- Have a name and can be used anywhere a value expected
- Not tied to a table or column
- Generate a numeric value that can be assigned to any column in any table
- Table attribute with an assigned value can be edited and modified
- Can be created and deleted any time
![](../images/Pasted%20image%2020250206230020.png)

### Procedural SQL
- Performs a conditional or looping operation by isolating critical code and making all application programs call the shared code 
	- Yields better maintenance and logic control
- Persistent stored module (PSM): Block of code containing:
	- Standard SQL statements
	- Procedural extensions that is stored and executed at the DBMS server
- Procedural Language SQL (PL/SQL)
	- Use and storage of procedural code and SQL statements within the database
	- Merging of SQL and traditional programming constructs
- Procedural code is executed as a unit by DBMS when invoked by end user
- End users can use PL/SQL to create:
	- Anonymous PL/SQL blocks and triggers
	- Stored procedures and PL/SQL functions

### PL/SQL Basic Data Types
![](../images/Pasted%20image%2020250206230220.png)

### Triggers
- Procedural SQL code automatically invoked by RDBMS when given data manipulation event occurs
- Parts of a trigger definition
	- Triggering timing - Indicates when triggerâ€™s PL/SQL code executes
	- Triggering event - Statement that causes the trigger to execute
	- Triggering level - Statement- and row-level
	- Triggering action - PL/SQL code enclosed between the BEGIN and END keywords
- DROP TRIGGER trigger_name command
	- Deletes a trigger without deleting the table
- Trigger action based on DML predicates
	- Actions depend on the type of DML statement that fires the trigger

### Stored Procedures
- Named collection of procedural and SQL statements
- Advantages
	- Reduce network traffic and increase performance
	- Reduce code duplication by means of code isolation and code sharing

### PL/SQL Processing with Cursors
- `Cursor`: Special construct used to hold data rows returned by a SQL query
- `Implicit cursor`: Automatically created when SQL statement returns only one value
- `Explicit cursor`: Holds the output of a SQL statement that may return two or more rows
- Cursor-style processing involves retrieving data from the cursor one row at a time
	- Current row is copied to PL/SQL variables

### Cursor Processing Commands
![](../images/Pasted%20image%2020250206230917.png)

### Cursor Attributes
![](../images/Pasted%20image%2020250206231004.png)

### PL/SQL Stored Functions
- `Stored function`: Named group of procedural and SQL statements that returns a value
	- As indicated by a RETURN statement in its program code
- Can be invoked only from within stored procedures or triggers

### Embedded SQL 
- SQL statements contained within an application programming language
- Host language: Any language that contains embedded SQL statements
- Differences between SQL and procedural languages
	- Run-time mismatch
		- SQL is executed one instruction at a time
		- Host language runs at client side in its own memory space
- Processing mismatch
	- Conventional programming languages process one data element at a time
	- Newer programming environments manipulate data sets in a cohesive manner
- Data type mismatch
	- Data types provided by SQL might not match data types used in different host languages
- Embedded SQL framework defines:
	- Standard syntax to identify embedded SQL code within the host language
	- Standard syntax to identify host variables
	- Communication area used to exchange status and error information between SQL and host language
-  Static SQL: Programmer uses predefined SQL statements and parameters
	- SQL statements will not change while application is running
- Dynamic SQL: SQL statement is generated at run time
	- Attribute list and condition are not known until end user specifies them
	- Slower than static SQL 
	- Requires more computer resources

### SQL Status and Error Reporting Variables
![](../images/Pasted%20image%2020250206231307.png)


